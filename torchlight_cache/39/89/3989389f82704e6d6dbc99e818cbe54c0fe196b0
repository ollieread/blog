1691061158a:5:{s:7:"wrapped";s:2138:"<pre><code data-theme='github-dark' data-lang='phpnamespace' class='torchlight' style='background-color: #24292e; --theme-selection-background: #39414a;'><!-- Syntax highlighted by torchlight.dev --><div class='line'>&nbsp;</div><div class='line'><span style="color: #e1e4e8;">use Illuminate\Database\Eloquent\Builder;</span></div><div class='line'><span style="color: #e1e4e8;">use Illuminate\Database\Eloquent\Model;</span></div><div class='line'><span style="color: #e1e4e8;">use Illuminate\Database\Eloquent\Scope;</span></div><div class='line'><span style="color: #e1e4e8;">use App\Services\TenantManager;</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #e1e4e8;">class TenantOwnedScope implements Scope {</span></div><div class='line'><span style="color: #e1e4e8;">    public function apply(Builder $builder, Model $model) {</span></div><div class='line'><span style="color: #e1e4e8;">        $manager = app(TenantManager::class);</span></div><div class='line'><span style="color: #e1e4e8;">        $builder-&gt;where(&#39;tenant_id&#39;, &#39;=&#39;, $manager-&gt;getTenant()-&gt;id);</span></div><div class='line'><span style="color: #e1e4e8;">    }</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #e1e4e8;">    public function extend(Builder $builder) {</span></div><div class='line'><span style="color: #e1e4e8;">        $this-&gt;addWithoutTenancy($builder);</span></div><div class='line'><span style="color: #e1e4e8;">    }</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #e1e4e8;">    protected function addWithoutTenancy(Builder $builder) {</span></div><div class='line'><span style="color: #e1e4e8;">        $builder-&gt;macro(&#39;withoutTenancy&#39;, function (Builder $builder) {</span></div><div class='line'><span style="color: #e1e4e8;">            return $builder-&gt;withoutGlobalScope($this);</span></div><div class='line'><span style="color: #e1e4e8;">        });</span></div><div class='line'><span style="color: #e1e4e8;">    }</span></div><div class='line'><span style="color: #e1e4e8;">}</span></div></code></pre>";s:11:"highlighted";s:1971:"<!-- Syntax highlighted by torchlight.dev --><div class='line'>&nbsp;</div><div class='line'><span style="color: #e1e4e8;">use Illuminate\Database\Eloquent\Builder;</span></div><div class='line'><span style="color: #e1e4e8;">use Illuminate\Database\Eloquent\Model;</span></div><div class='line'><span style="color: #e1e4e8;">use Illuminate\Database\Eloquent\Scope;</span></div><div class='line'><span style="color: #e1e4e8;">use App\Services\TenantManager;</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #e1e4e8;">class TenantOwnedScope implements Scope {</span></div><div class='line'><span style="color: #e1e4e8;">    public function apply(Builder $builder, Model $model) {</span></div><div class='line'><span style="color: #e1e4e8;">        $manager = app(TenantManager::class);</span></div><div class='line'><span style="color: #e1e4e8;">        $builder-&gt;where(&#39;tenant_id&#39;, &#39;=&#39;, $manager-&gt;getTenant()-&gt;id);</span></div><div class='line'><span style="color: #e1e4e8;">    }</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #e1e4e8;">    public function extend(Builder $builder) {</span></div><div class='line'><span style="color: #e1e4e8;">        $this-&gt;addWithoutTenancy($builder);</span></div><div class='line'><span style="color: #e1e4e8;">    }</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #e1e4e8;">    protected function addWithoutTenancy(Builder $builder) {</span></div><div class='line'><span style="color: #e1e4e8;">        $builder-&gt;macro(&#39;withoutTenancy&#39;, function (Builder $builder) {</span></div><div class='line'><span style="color: #e1e4e8;">            return $builder-&gt;withoutGlobalScope($this);</span></div><div class='line'><span style="color: #e1e4e8;">        });</span></div><div class='line'><span style="color: #e1e4e8;">    }</span></div><div class='line'><span style="color: #e1e4e8;">}</span></div>";s:6:"styles";s:65:"background-color: #24292e; --theme-selection-background: #39414a;";s:7:"classes";s:10:"torchlight";s:5:"attrs";a:2:{s:10:"data-theme";s:11:"github-dark";s:9:"data-lang";s:12:"phpnamespace";}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>How I accidentally created an ORM to avoid using Eloquent | ollieread.com</title>

    <link rel="home" href="https://ollieread.com">
    <link rel="icon" href="/favicon.ico">
    <link href="/blog/feed.atom" type="application/atom+xml" rel="alternate" title="ollieread.com Atom Feed">

    <link rel="stylesheet" href="/assets/build/css/app.css?id=329e22548cfa15d757c9d63c52236e9f">

    
        <!--  Metadata -->
    <meta name="description" content="" />

    <!-- OpenGraph Metadata -->
    <meta name="og:type" property="og:type" content="article" />
    <meta name="og:title" property="og:title" content="How I accidentally created an ORM to avoid using Eloquent"/>
    <meta name="og:url" property="og:url" content="https://ollieread.com/archive/read/how-i-accidentally-created-an-orm-to-avoid-using-eloquent" />
    <meta name="og:locale" property="og:locale" content="en_GB" />
    <meta name="og:site_name" property="og:site_name" content="ollieread.com"/>
    <meta name="og:image" property="og:image" content="/assets/images/page-thumbnail.png" />

    <!-- Article Metadata -->
    <meta name="article:published_time" property="article:published_time" content="2018-08-07T17:35:25+00:00"/>
    <meta name="article:section" property="article:section" content="updates"/>

    <!-- Twitter Metadata -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:creator" content="@ollieread" />
</head>

<body class="antialiased">

<header class="header">

    <nav class="header__links">
    <a href="https://twitter.com/ollieread" target="__blank" class="header__link header__link--twitter">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
    <a href="https://phpc.social/@ollieread" target="__blank" class="header__link header__link--mastodon" rel="me">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
    </a>
    <a href="https://github.com/ollieread" target="__blank" class="header__link header__link--github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
    <a href="https://youtube.com/@olliecodes" target="__blank" class="header__link header__link--youtube">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
    <a href="https://discord.gg/rtQF6jCTk3" target="__blank" class="header__link header__link--discord">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg>
    </a>
</nav>    <img src="/assets/images/ollieread.jpg"
         alt="Picture of ollieread"
         class="header__image">

    <div class="header__title">Ollie Read</div>

    <div class="header__nav navbar">
    <a href="/" class="navbar__item ">
        <svg class="navbar__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M272.5 5.7C281.4-1.9 294.6-1.9 303.5 5.7L567.5 229.7C577.6 238.3 578.9 253.4 570.3 263.5C561.7 273.6 546.6 274.9 536.5 266.3L512 245.5V432C512 476.2 476.2 512 432 512H144C99.82 512 64 476.2 64 432V245.5L39.53 266.3C29.42 274.9 14.28 273.6 5.7 263.5C-2.876 253.4-1.634 238.3 8.473 229.7L272.5 5.7zM112 204.8V432C112 449.7 126.3 464 144 464H432C449.7 464 464 449.7 464 432V204.8L288 55.47L112 204.8z"/></svg>
        <svg class="navbar__icon navbar__icon--full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c.2 35.5-28.5 64.3-64 64.3H128.1c-35.3 0-64-28.7-64-64V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/></svg>
        Home
    </a>
    <a href="/articles" class="navbar__item ">
        <svg class="navbar__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M456 32h-304C121.1 32 96 57.13 96 88v320c0 13.22-10.77 24-24 24S48 421.2 48 408V112c0-13.25-10.75-24-24-24S0 98.75 0 112v296C0 447.7 32.3 480 72 480h352c48.53 0 88-39.47 88-88v-304C512 57.13 486.9 32 456 32zM464 392c0 22.06-17.94 40-40 40H139.9C142.5 424.5 144 416.4 144 408v-320c0-4.406 3.594-8 8-8h304c4.406 0 8 3.594 8 8V392zM264 272h-64C186.8 272 176 282.8 176 296S186.8 320 200 320h64C277.3 320 288 309.3 288 296S277.3 272 264 272zM408 272h-64C330.8 272 320 282.8 320 296S330.8 320 344 320h64c13.25 0 24-10.75 24-24S421.3 272 408 272zM264 352h-64c-13.25 0-24 10.75-24 24s10.75 24 24 24h64c13.25 0 24-10.75 24-24S277.3 352 264 352zM408 352h-64C330.8 352 320 362.8 320 376s10.75 24 24 24h64c13.25 0 24-10.75 24-24S421.3 352 408 352zM400 112h-192c-17.67 0-32 14.33-32 32v64c0 17.67 14.33 32 32 32h192c17.67 0 32-14.33 32-32v-64C432 126.3 417.7 112 400 112z"/></svg>
        <svg class="navbar__icon navbar__icon--full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M96 96c0-35.3 28.7-64 64-64H448c35.3 0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H80c-44.2 0-80-35.8-80-80V128c0-17.7 14.3-32 32-32s32 14.3 32 32V400c0 8.8 7.2 16 16 16s16-7.2 16-16V96zm64 24v80c0 13.3 10.7 24 24 24H424c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24H184c-13.3 0-24 10.7-24 24zm0 184c0 8.8 7.2 16 16 16h96c8.8 0 16-7.2 16-16s-7.2-16-16-16H176c-8.8 0-16 7.2-16 16zm160 0c0 8.8 7.2 16 16 16h96c8.8 0 16-7.2 16-16s-7.2-16-16-16H336c-8.8 0-16 7.2-16 16zM160 400c0 8.8 7.2 16 16 16h96c8.8 0 16-7.2 16-16s-7.2-16-16-16H176c-8.8 0-16 7.2-16 16zm160 0c0 8.8 7.2 16 16 16h96c8.8 0 16-7.2 16-16s-7.2-16-16-16H336c-8.8 0-16 7.2-16 16z"/></svg>
        Articles
    </a>
    <a href="/archive" class="navbar__item ">
        <svg class="navbar__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M464 32h-416C21.49 32 0 53.49 0 80v64C0 161.6 14.4 176 31.1 176L32 416c0 35.35 28.65 64 64 64h320c35.35 0 64-28.65 64-64V176c17.6 0 32-14.4 32-31.1V80C512 53.49 490.5 32 464 32zM416 432H96c-8.837 0-16-7.163-16-16V176h352V416C432 424.8 424.8 432 416 432zM464 128h-416V80h416V128zM183.1 272h144C341.3 272 352 261.3 352 248C352 234.7 341.3 224 328 224H183.1C170.7 224 160 234.7 160 247.1C160 261.3 170.7 272 183.1 272z"/></svg>
        <svg class="navbar__icon navbar__icon--full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M32 32H480c17.7 0 32 14.3 32 32V96c0 17.7-14.3 32-32 32H32C14.3 128 0 113.7 0 96V64C0 46.3 14.3 32 32 32zm0 128H480V416c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V160zm128 80c0 8.8 7.2 16 16 16H336c8.8 0 16-7.2 16-16s-7.2-16-16-16H176c-8.8 0-16 7.2-16 16z"/></svg>
        Archive
    </a>
    
</div>
</header>

<main class="section content">
    
    
    <div class="panel">
    
    <header class="panel__header">

        <div class="panel__badges">
            <a href="/"
               class="badge badge--green">Category</a>
                            <span class="badge badge--red">Archived</span>
                    </div>

        <h1 class="panel__header-title">How I accidentally created an ORM to avoid using Eloquent</h1>

        <time class="panel__header-time">7th August, 2018</time>

    </header>
    <main class="panel__body">
        <p>Eloquent is a well thought out powerful ORM. It makes the initial steps of any Laravel build easy, but at this point it has become somewhat bloated.</p>
<p>Many a time I've encountered a wall when I tried to do something with Eloquent that it absolutely didn't like. Sure, it's flexible enough that I can work around, and after some time digging through the masses of functionality and methods that come with every Model, I was able to find what I needed, but it all just felt a bit...dirty.</p>
<p>After a while I noticed that some of my codebases were rife with 'work arounds' (read: hacks) to achieve what I needed while still within the confines of Eloquent. That didn't sit well with me, so I started exploring methods to get away from this way of doing things. Then came...</p>
<h1><a id="doctrine" href="#doctrine" class="hidden" aria-hidden="true" title="Permalink"></a>Doctrine</h1>
<p>Doctrine again, is a super powerful ORM and while more complex to setup, it can simplify your life. For a while, I swore by Doctrine and used it in place of Eloquent whenever I could. The plus side of Doctrine, much like Eloquent, is that it can do everything. The down side, also like Eloquent, is that it can do everything. Doctrine, as good as it is, is a monolithic ORM that dwarfs Eloquent in comparison.</p>
<p>While Eloquent uses the Active Record pattern, Doctrine uses the Entity Mapper pattern, something that due to my days with Java, I was instantly in love with.</p>
<h1><a id="bringing-entities-to-eloquent" href="#bringing-entities-to-eloquent" class="hidden" aria-hidden="true" title="Permalink"></a>Bringing Entities to Eloquent</h1>
<p>I didn't want to write my own ORM, because ORMs are complicated and hard. But what if I could bring the approach that I love, to Eloquent?</p>
<p>This is actually where Articulate started, hence the name Articulate. It was originally designed to be a wrapper for Eloquent, that let me return entities instead of models. The models were still there, but were treated as query objects that were just used to hydrate my simple data object entities. This worked well, and appeased my need for something different, for a while. After the initial high of working with entities wore off, I realised that the underlying problem was still there, I was still having to add 'work arounds' here and there, and the underlying code was still ugly to look at. The only logical next step, was to remove the models entirely...</p>
<h1><a id="stripping-out-models" href="#stripping-out-models" class="hidden" aria-hidden="true" title="Permalink"></a>Stripping out Models</h1>
<p>So all Eloquent models are essentially fancy wrappers for the underlying query builder, and that's cool, because I really like that query builder. However, in removing the models from the equation, I found that I had no way to specify tables, columns or their data types. No way to provide relationship configuration.</p>
<p>For a brief time, this didn't bother me. I was happy hard coding that stuff in repositories, because it all seemed..nicer. I'd build my query, run it, then throw the results at an entity manager that would hydrate an entity for me. Slowly I started adding getters and setters that cast and transformed data to the correct types.</p>
<p>Eventually I realised that although simpler than Eloquent models, my entities still had loads of code that they probably didn't have any right to have. So I introduced mappings, Doctrine uses mappings, so I'll go with that...</p>
<h1><a id="mapping-my-entities" href="#mapping-my-entities" class="hidden" aria-hidden="true" title="Permalink"></a>Mapping my Entities</h1>
<p>So I created some mappings, and column/attribute classes to handle the different types. In my mappings you'd provide the table name, the entity class name, and then map each column that you wanted mapping, to a type. An example of one of the earlier mappings is below;</p>
<pre><code data-theme="github-dark" data-lang="php" class='torchlight' style='background-color: #24292e; --theme-selection-background: #39414a;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color: #F97583;">namespace</span><span style="color: #E1E4E8;"> </span><span style="color: #B392F0;">Ollieread\Mappings</span><span style="color: #E1E4E8;">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #F97583;">use</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">Ollieread\Articulate\EntityMapping</span><span style="color: #E1E4E8;">;</span></div><div class='line'><span style="color: #F97583;">use</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">Ollieread\Articulate\Contracts\Mapping</span><span style="color: #E1E4E8;">;</span></div><div class='line'><span style="color: #F97583;">use</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">Ollieread\Entities\Admin</span><span style="color: #E1E4E8;">;</span></div><div class='line'><span style="color: #F97583;">use</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">Ollieread\Repositories\AdminRepository</span><span style="color: #E1E4E8;">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #F97583;">class</span><span style="color: #E1E4E8;"> </span><span style="color: #B392F0;">AdminMapping</span><span style="color: #E1E4E8;"> </span><span style="color: #F97583;">extends</span><span style="color: #E1E4E8;"> </span><span style="color: #B392F0;">EntityMapping</span></div><div class='line'><span style="color: #E1E4E8;">{</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">public</span><span style="color: #E1E4E8;"> </span><span style="color: #F97583;">function</span><span style="color: #E1E4E8;"> </span><span style="color: #B392F0;">entity</span><span style="color: #E1E4E8;">()</span><span style="color: #F97583;">:</span><span style="color: #E1E4E8;"> </span><span style="color: #F97583;">string</span><span style="color: #E1E4E8;"> {</span></div><div class='line'><span style="color: #E1E4E8;">        </span><span style="color: #F97583;">return</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">Admin</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">;</span></div><div class='line'><span style="color: #E1E4E8;">    }</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">public</span><span style="color: #E1E4E8;"> </span><span style="color: #F97583;">function</span><span style="color: #E1E4E8;"> </span><span style="color: #B392F0;">table</span><span style="color: #E1E4E8;">()</span><span style="color: #F97583;">:</span><span style="color: #E1E4E8;"> </span><span style="color: #F97583;">string</span><span style="color: #E1E4E8;"> {</span></div><div class='line'><span style="color: #E1E4E8;">        </span><span style="color: #F97583;">return</span><span style="color: #E1E4E8;"> </span><span style="color: #9ECBFF;">&#39;admins&#39;</span><span style="color: #E1E4E8;">;</span></div><div class='line'><span style="color: #E1E4E8;">    }</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">public</span><span style="color: #E1E4E8;"> </span><span style="color: #F97583;">function</span><span style="color: #E1E4E8;"> </span><span style="color: #B392F0;">map</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Mapping</span><span style="color: #E1E4E8;"> $mapper) {</span></div><div class='line'><span style="color: #E1E4E8;">        $mapper</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">setKey</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;id&#39;</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">        $mapper</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">setRepository</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">AdminRepository</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">        $mapper</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">mapInt</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;id&#39;</span><span style="color: #E1E4E8;">)</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">setImmutable</span><span style="color: #E1E4E8;">();</span></div><div class='line'><span style="color: #E1E4E8;">        $mapper</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">mapString</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;name&#39;</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">        $mapper</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">mapString</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;email&#39;</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">        $mapper</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">mapString</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;password&#39;</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">        $mapper</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">mapString</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;remember_token&#39;</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">        $mapper</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">mapTimestamp</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;created_at&#39;</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">        $mapper</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">mapTimestamp</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;updated_at&#39;</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">    }</span></div><div class='line'><span style="color: #E1E4E8;">}</span></div></code></pre>
<p>It's relatively straight forward, you set the attributes for the key, tell it what repository to use and then map all the other attributes you care about.</p>
<p>Again, this worked well, I'd use the laravel query builder and then throw the result at an entity manager. The entity manager didn't care where the data came from, just that it was there. I created myself a base repository that had some persistence code in there so I didn't have to write update or insert queries, or manually populate the timestamp attributes. This was all good and well, but checking for the presence and value of the <code>updated_at</code> column wasn't a very efficient way of telling whether something should be an update, or insert, since I had entities that didn't have timestamps.</p>
<p>To achieve this, I'd need to introduce some sort of basic state to my entities...</p>
<h1><a id="introducing-entity-states" href="#introducing-entity-states" class="hidden" aria-hidden="true" title="Permalink"></a>Introducing Entity States</h1>
<p>Persistence state is super simple, just add a boolean flag and a method that checks whether the entity is persisted. But I didn't want to litter my entities with this. So instead, I created a base entity that had this functionality in. I added another method to mark an entity as persisted, and then rolled with it.</p>
<p>Eventually a time came when I only wanted updates to be performed if the entity was dirty. So in goes another state. Super simple, keeps track of which attribute has changed, but that's going to get annoying having to do that in every setter. So I made getters and setters optional, and instead introduced an attributes array to the base entity. It worked quite well, and with a <code>__get()</code> and <code>__set()</code> implementation I was able to use dynamic properties (which I defined in my docblocks). The base entity would check for a getter so that I could support completely dynamic attributes that didn't exist in my attributes array, and all was well.</p>
<p>The only problem now, was that when I hydrated an entity, it was dirty? So in goes a method to clean the dirty state, that would be called after initial hydration.</p>
<p>I was quite happy with what I had, and I was especially happy with the fact that I had created a data source agnostic system. The only part of my code that knew about the data source, was the repository, and those could be anything. After a while, I realised that the mappings made the code specific to Laravels query builder, or at least, a database....</p>
<h1><a id="abstracting-data-sources" href="#abstracting-data-sources" class="hidden" aria-hidden="true" title="Permalink"></a>Abstracting Data Sources</h1>
<p>My next step was to abstract out data sources. I created myself an <code>Illuminate</code> source that had a builder (overridden Laravel query builder), base repository, source definition, and even its own mapping where you could provide the table name and connection name.</p>
<p>Although only one data source existed, Articulate was finally, a data source agnostic package, or as I like to refer to it, a data source agnostic entity mapper pseudo ORM. Bit of a mouth full, but I like it.</p>
<p>Off I went to build some projects using my new pseudo ORM, and things were wonderful. My code seemed cleaner, there was a bigger separation between data source and domain objects, and again, life was wonderful. I couldn't however, shake the idea that Articulate couldn't be data source agnostic with only one data source. Fortunately, I had a pet project where I'd been trying to abstract out the way that we interact with REST APIs, since there seemed to be no standard. So I created Respite (you can <a rel="noopener noreferrer" target="_blank" class="link link--external" href="https://ollieread.com/blog/2018/07/19/treating-apis-like-any-other-data-source">read about it here</a>), a package that provided a fluent builder to build up API requests for RESTful APIs. I decided to go a step further and introduce a Respite source into Articulate, because as far as I was concerned, it'd be super cool to treat APIs like they're just a database!</p>
<p>It was at this point, having introduced a second data source support, and made Articulate truly data source agnostic in my mind, that I realised what I had done. I had, for all intents and purposes, built an ORM. Truly, I had accidentally built an entire ORM. Sure, it's far simpler than Doctrine, and quite different to Eloquent. There may be certain parts that you'd expect to be there that aren't, but it's flexible. It's easily customisable. And you know what? I love it!</p>
<h1><a id="accepting-my-fate" href="#accepting-my-fate" class="hidden" aria-hidden="true" title="Permalink"></a>Accepting my Fate</h1>
<p>With the realisation that I had in fact, created an ORM, I decided to just go full hog and treat it as such, introducing the following;</p>
<h3><a id="components" href="#components" class="hidden" aria-hidden="true" title="Permalink"></a>Components</h3>
<p>Components are objects that encapsulate one or more columns. A primary example of this would be an <code>Address</code> component that contains the following attributes;</p>
<ul>
<li>
<code>address_1</code>
</li>
<li>
<code>address_2</code>
</li>
<li>
<code>address_3</code>
</li>
<li>
<code>address_city</code>
</li>
<li>
<code>address_county</code>
</li>
<li>
<code>address_country</code>
</li>
<li>
<code>address_postcode</code>
</li>
</ul>
<p>In this case I can pass my address component anywhere that needs an address, so I can create more flexible code, and rather than different implementations for different address sources, I can have one implementation.</p>
<p>On top of that, it means that I don't have to map those attributes on each entity. Instead I can create one global component mapping, meaning that I just add;</p>
<pre><code data-theme="github-dark" data-lang="php" class='torchlight' style='background-color: #24292e; --theme-selection-background: #39414a;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">component</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;address&#39;</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Address</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">)</span></div></code></pre>
<p>And there we go, my entity has inherited the mapping, so instead of <code>$entity-&gt;address_line_1</code> I can just do <code>$entity-&gt;address-&gt;line_1</code>. It will also work for writes, providing that the component isn't immutable (value object).</p>
<h3><a id="multiple-inheritance" href="#multiple-inheritance" class="hidden" aria-hidden="true" title="Permalink"></a>Multiple Inheritance</h3>
<p>While similar to the feature of Doctrine with the same name, it's slightly different. It's closer to single table inheritance, but since it doesn't care about tables, it's about the entities.</p>
<p>A good example of this is the <a rel="noopener noreferrer" target="_blank" class="link link--external" href="https://github.com/ollieread/discord-api">discord api</a> package I've been working on which utilises Articulates Respite source. The discord API will return channels, but a channel can be a DM, text channel or voice channel. There is an attribute that specifies the type, and with each type, there are different sets of attributes. So I define this in my mapping like so;</p>
<pre><code data-theme="github-dark" data-lang="php" class='torchlight' style='background-color: #24292e; --theme-selection-background: #39414a;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color: #E1E4E8;">$mapping</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">setChildClasses</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\Text</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\DM</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\Voice</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\Category</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">setMultipleInheritance</span><span style="color: #E1E4E8;">(</span><span style="color: #F97583;">function</span><span style="color: #E1E4E8;"> (</span><span style="color: #F97583;">array</span><span style="color: #E1E4E8;"> $data) {</span></div><div class='line'><span style="color: #E1E4E8;">        </span><span style="color: #F97583;">switch</span><span style="color: #E1E4E8;"> ((</span><span style="color: #F97583;">int</span><span style="color: #E1E4E8;">)$data[</span><span style="color: #9ECBFF;">&#39;type&#39;</span><span style="color: #E1E4E8;">]) {</span></div><div class='line'><span style="color: #E1E4E8;">            </span><span style="color: #F97583;">case</span><span style="color: #E1E4E8;"> </span><span style="color: #F97583;">self::</span><span style="color: #79B8FF;">TEXT</span><span style="color: #E1E4E8;">:</span></div><div class='line'><span style="color: #E1E4E8;">                </span><span style="color: #F97583;">return</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">Channel\Text</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">;</span></div><div class='line'><span style="color: #E1E4E8;">            </span><span style="color: #F97583;">case</span><span style="color: #E1E4E8;"> </span><span style="color: #F97583;">self::</span><span style="color: #79B8FF;">DM</span><span style="color: #E1E4E8;">:</span></div><div class='line'><span style="color: #E1E4E8;">                </span><span style="color: #F97583;">return</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">Channel\DM</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">;</span></div><div class='line'><span style="color: #E1E4E8;">            </span><span style="color: #F97583;">case</span><span style="color: #E1E4E8;"> </span><span style="color: #F97583;">self::</span><span style="color: #79B8FF;">VOICE</span><span style="color: #E1E4E8;">:</span></div><div class='line'><span style="color: #E1E4E8;">                </span><span style="color: #F97583;">return</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">Channel\Voice</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">;</span></div><div class='line'><span style="color: #E1E4E8;">            </span><span style="color: #F97583;">case</span><span style="color: #E1E4E8;"> </span><span style="color: #F97583;">self::</span><span style="color: #79B8FF;">GROUP_DM</span><span style="color: #E1E4E8;">:</span></div><div class='line'><span style="color: #E1E4E8;">                </span><span style="color: #F97583;">return</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">Channel\DM</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">;</span></div><div class='line'><span style="color: #E1E4E8;">            </span><span style="color: #F97583;">case</span><span style="color: #E1E4E8;"> </span><span style="color: #F97583;">self::</span><span style="color: #79B8FF;">CATEGORY</span><span style="color: #E1E4E8;">:</span></div><div class='line'><span style="color: #E1E4E8;">                </span><span style="color: #F97583;">return</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">Channel\Category</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">;</span></div><div class='line'><span style="color: #E1E4E8;">        }</span></div><div class='line'><span style="color: #E1E4E8;">        </span><span style="color: #F97583;">return</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">Channel</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">;</span></div><div class='line'><span style="color: #E1E4E8;">    });</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">snowflake</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;id&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">setImmutable</span><span style="color: #E1E4E8;">();</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">int</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;type&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">setImmutable</span><span style="color: #E1E4E8;">();</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">snowflake</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;guild_id&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">for</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\Voice</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\Text</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\Category</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">int</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;position&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">for</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\Voice</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\Text</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\Category</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">entity</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;permission_overwrites&#39;</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\Overwrite</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">true</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">belongsTo</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\Voice</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\Text</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">string</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;name&#39;</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">string</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;topic&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">for</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\Text</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">bool</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;nsfw&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">for</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\Voice</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\Text</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">snowflake</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;last_message_id&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">for</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\Text</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\DM</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">int</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;bitrate&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">for</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\Voice</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">int</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;user_limit&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">for</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\Voice</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">array</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;recipients&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">for</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\DM</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">string</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;icon&#39;</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">snowflake</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;owner_id&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">for</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\DM</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">snowflake</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;application_id&#39;</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">snowflake</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;parent_id&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">for</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\Voice</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\Text</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">Channel\Category</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">timestamp</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;last_pin_timestamp&#39;</span><span style="color: #E1E4E8;">, </span><span style="color: #9ECBFF;">&#39;c&#39;</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">setImmutable</span><span style="color: #E1E4E8;">()</span></div><div class='line'><span style="color: #E1E4E8;">    </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">for</span><span style="color: #E1E4E8;">(</span><span style="color: #79B8FF;">Channel\Text</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">);</span></div></code></pre>
<h3><a id="relationships" href="#relationships" class="hidden" aria-hidden="true" title="Permalink"></a>Relationships</h3>
<p>A core part of any ORM is relationships. I'm currently working on an implementation of this, but in a simpler way than Laravel. Since you can already specify entity attributes, like in the example above, I simply add a <code>setResolver()</code> method to entity attributes, that takes an instance of <code>Sprocketbox\Articulate\Contracts\Resolver</code> or <code>\Closure</code>.</p>
<p>It's still a WIP, and I've added a few Illuminate specific resolvers, but my local code looks like this for the entity definition;</p>
<pre><code data-theme="github-dark" data-lang="php" class='torchlight' style='background-color: #24292e; --theme-selection-background: #39414a;'><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color: #E1E4E8;">$mapping</span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">entity</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;user&#39;</span><span style="color: #E1E4E8;">, </span><span style="color: #79B8FF;">User</span><span style="color: #F97583;">::class</span><span style="color: #E1E4E8;">)</span></div><div class='line'><span style="color: #E1E4E8;">        </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">setResolver</span><span style="color: #E1E4E8;">(</span><span style="color: #F97583;">new</span><span style="color: #E1E4E8;"> </span><span style="color: #79B8FF;">BelongsTo</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;user_id&#39;</span><span style="color: #E1E4E8;">, </span><span style="color: #9ECBFF;">&#39;id&#39;</span><span style="color: #E1E4E8;">))</span></div><div class='line'><span style="color: #E1E4E8;">        </span><span style="color: #F97583;">-&gt;</span><span style="color: #B392F0;">setColumnName</span><span style="color: #E1E4E8;">(</span><span style="color: #9ECBFF;">&#39;user_id&#39;</span><span style="color: #E1E4E8;">);</span></div></code></pre>
<p>So when querying the entity that this mapping is for (<code>Assignments</code>) I can simply add <code>$query-&gt;with('user')</code> and it'll use the resolver to load and populate the user.</p>
<p>The wonderful side effect of this particular piece of functionality, is that it will work across data sources. I could have <code>$query-&gt;with('stripe_customer')</code> in my query, and after retrieving my user from the database, it'd call the Stripe API, retrieve the customer data, build it into a previously define entity, and inject it. How marvelous!</p>
<h1><a id="should-i-use-articulate" href="#should-i-use-articulate" class="hidden" aria-hidden="true" title="Permalink"></a>Should I use Articulate?</h1>
<p>If you want to. I enjoy it far more than Eloquent, and I find that it keeps my codebase tidier, but it's not everyones cup of tea. It's primary reason for existence is that some of the things I was working on required some quite complex queries, along with some complex functionality, so I was trying to find a way to make the codebase less daunting.</p>
<p>If you want to use Articulate, you can find it <a rel="noopener noreferrer" target="_blank" class="link link--external" href="https://github.com/sprocketbox/articulate">here</a> and you can find WIP documentation <a rel="noopener noreferrer" target="_blank" class="link link--external" href="https://sprocketbox.github.io/articulate">here</a>.</p>
<p>I'm interested in hearing your thoughts on the package, whether you've used it or would consider it, or even your thoughts on Eloquent.</p>
    </main>
</div>
</main>

    <!-- Fathom - beautiful, simple website analytics -->
    <script src="https://cdn.usefathom.com/script.js" data-site="THPWLTOW" defer></script>
    <!-- / Fathom -->

<script src="/assets/build/js/main.js?id=332d80b6520e8206b9564927e5f9bd73"></script>


</body>
</html>
